# Notta - ä¼ä¸šçº§å¤šAgent RAGç³»ç»Ÿ

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://python.org)
[![DeepSeek](https://img.shields.io/badge/LLM-DeepSeek-green.svg)](https://deepseek.com)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

ä¸€ä¸ªåŸºäºå¤šAgentæ¶æ„çš„ä¼ä¸šçº§æ™ºèƒ½æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)ç³»ç»Ÿï¼Œä¸“ä¸ºå¤æ‚æŸ¥è¯¢çš„å¤šè·³æ¨ç†è€Œè®¾è®¡ã€‚ç³»ç»Ÿé‡‡ç”¨è§„åˆ’-æ£€ç´¢-åˆ†æçš„ä¸‰å±‚Agentåä½œæ¨¡å¼ï¼Œèƒ½å¤Ÿå¤„ç†é—´æ¥ä¿¡æ¯é—®é¢˜å¹¶æä¾›é«˜è´¨é‡çš„æ¨ç†é“¾æ¡ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªæ”¯æŒå¤šè·³æ¨ç†çš„ Agentic RAG ç³»ç»Ÿï¼Œèƒ½å¤Ÿå¤„ç†å¤æ‚çš„çŸ¥è¯†é—®ç­”åœºæ™¯ã€‚ä¾‹å¦‚ï¼š

**ç”¨æˆ·æé—®**ï¼š"å¼ ä¸‰å‚ä¸äº†å“ªä¸ªé¡¹ç›®ï¼Ÿ"

**çŸ¥è¯†åº“å†…å®¹**ï¼š
- Chunk1: "å¼ ä¸‰ä¸æå››åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­"
- Chunk2: "æå››å‚ä¸äº†é£å¤©é¡¹ç›®"

**ç³»ç»Ÿæ¨ç†**ï¼šé€šè¿‡å¤šAgentåä½œï¼Œç³»ç»Ÿèƒ½å¤Ÿè¿æ¥è¿™ä¸¤ä¸ªä¿¡æ¯ç‰‡æ®µï¼Œæ¨ç†å‡º"å¼ ä¸‰å‚ä¸äº†é£å¤©é¡¹ç›®"è¿™ä¸€ç­”æ¡ˆã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Planner       â”‚    â”‚   Retriever     â”‚    â”‚   Analyzer      â”‚
â”‚   Agent         â”‚â”€â”€â”€â–¶â”‚   Agent         â”‚â”€â”€â”€â–¶â”‚   Agent         â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ æŸ¥è¯¢åˆ†æ      â”‚    â”‚ â€¢ æ–‡æ¡£æ£€ç´¢      â”‚    â”‚ â€¢ å¤šè·³æ¨ç†      â”‚
â”‚ â€¢ è§„åˆ’åˆ¶å®š      â”‚    â”‚ â€¢ æ‰©å±•æœç´¢      â”‚    â”‚ â€¢ ç»“æœåˆ†æ      â”‚
â”‚ â€¢ å®ä½“è¯†åˆ«      â”‚    â”‚ â€¢ ç›¸å…³æ€§è¯„ä¼°    â”‚    â”‚ â€¢ ç½®ä¿¡åº¦è¯„ä¼°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent èŒè´£åˆ†å·¥

#### 1. Planner Agent (è§„åˆ’æ™ºèƒ½ä½“)
- **èŒè´£**ï¼šåˆ†æç”¨æˆ·æŸ¥è¯¢ï¼Œåˆ¶å®šæ£€ç´¢å’Œæ¨ç†ç­–ç•¥
- **åŠŸèƒ½**ï¼š
  - åˆ¤æ–­æŸ¥è¯¢ç±»å‹ï¼ˆç®€å•/å¤šè·³ï¼‰
  - è¯†åˆ«å…³é”®å®ä½“å’Œå…³ç³»
  - åˆ¶å®šåˆ†æ­¥æ£€ç´¢è®¡åˆ’
  - é¢„ä¼°æ¨ç†è·³æ•°

#### 2. Retriever Agent (æ£€ç´¢æ™ºèƒ½ä½“)
- **èŒè´£**ï¼šæ ¹æ®è§„åˆ’æ‰§è¡Œç²¾ç¡®çš„æ–‡æ¡£æ£€ç´¢
- **åŠŸèƒ½**ï¼š
  - å¤šè½®æ£€ç´¢æ‰§è¡Œ
  - å…³é”®è¯ä¼˜åŒ–
  - æ‰©å±•æœç´¢
  - ç›¸å…³æ€§è¯„ä¼°

#### 3. Analyzer Agent (åˆ†ææ™ºèƒ½ä½“)
- **èŒè´£**ï¼šåˆ†ææ£€ç´¢ç»“æœï¼Œæ‰§è¡Œå¤šè·³æ¨ç†
- **åŠŸèƒ½**ï¼š
  - ä¿¡æ¯æå–å’Œæ•´åˆ
  - æ¨ç†é“¾æ¡æ„å»º
  - ç½®ä¿¡åº¦è¯„ä¼°
  - ç¼ºå¤±ä¿¡æ¯è¯†åˆ«

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- DeepSeek API å¯†é’¥

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### é…ç½®è®¾ç½®

1. ç¼–è¾‘ `config/settings.py`ï¼Œè®¾ç½®æ‚¨çš„ DeepSeek API å¯†é’¥ï¼š

```python
DEEPSEEK_API_KEY = "sk-your-actual-deepseek-api-key"
```

### è¿è¡Œæ–¹å¼

#### 1. äº¤äº’æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
python cli_app.py
```

#### 2. å•æ¬¡æŸ¥è¯¢æ¨¡å¼

```bash
python cli_app.py -q "å¼ ä¸‰å‚ä¸äº†å“ªä¸ªé¡¹ç›®ï¼Ÿ"
```

#### 3. æ‰¹å¤„ç†æ¨¡å¼

```bash
# åˆ›å»ºæŸ¥è¯¢æ–‡ä»¶
echo "å¼ ä¸‰å‚ä¸äº†å“ªä¸ªé¡¹ç›®ï¼Ÿ" > queries.txt
echo "é£å¤©é¡¹ç›®çš„å›¢é˜Ÿæˆå‘˜æœ‰å“ªäº›ï¼Ÿ" >> queries.txt

# æ‰§è¡Œæ‰¹å¤„ç†
python cli_app.py -b queries.txt -o results.json
```

#### 4. è®¾ç½®çŸ¥è¯†åº“

```bash
python cli_app.py --setup-kb
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å¤šè·³æ¨ç†ç¤ºä¾‹

**æŸ¥è¯¢**: "å¼ ä¸‰å‚ä¸äº†å“ªä¸ªé¡¹ç›®ï¼Ÿ"

**ç³»ç»Ÿå¤„ç†æµç¨‹**:

1. **Planner Agent åˆ†æ**:
   ```json
   {
     "query_type": "multi_hop",
     "key_entities": ["å¼ ä¸‰"],
     "reasoning_steps": [
       {
         "step": 1,
         "action": "search",
         "target": "å¼ ä¸‰",
         "purpose": "æŸ¥æ‰¾å¼ ä¸‰çš„ç›¸å…³ä¿¡æ¯"
       }
     ],
     "expected_hops": 2
   }
   ```

2. **Retriever Agent æ£€ç´¢**:
   - ç¬¬1è½®ï¼šæœç´¢"å¼ ä¸‰" â†’ æ‰¾åˆ°"å¼ ä¸‰ä¸æå››åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­"
   - ç¬¬2è½®ï¼šæœç´¢"æå››" â†’ æ‰¾åˆ°"æå››å‚ä¸äº†é£å¤©é¡¹ç›®"

3. **Analyzer Agent æ¨ç†**:
   ```json
   {
     "reasoning_chain": [
       {
         "step": 1,
         "fact": "å¼ ä¸‰ä¸æå››åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­",
         "source": "é¡¹ç›®è®°å½•"
       },
       {
         "step": 2,
         "fact": "æå››å‚ä¸äº†é£å¤©é¡¹ç›®",
         "source": "é¡¹ç›®è®°å½•"
       }
     ],
     "conclusion": "å¼ ä¸‰å‚ä¸äº†é£å¤©é¡¹ç›®",
     "confidence": 0.9
   }
   ```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Agno (Agentåä½œæ¡†æ¶)
- **LLM**: DeepSeek API
- **å‘é‡å­˜å‚¨**: FAISS
- **æ–‡æ¡£å¤„ç†**: LangChain
- **åµŒå…¥æ¨¡å‹**: BGE-M3

### å…³é”®ç‰¹æ€§

1. **å¤šAgentåä½œ**: ä¸‰ä¸ªä¸“é—¨åŒ–Agentåˆ†å·¥åˆä½œ
2. **å¤šè·³æ¨ç†**: æ”¯æŒå¤æ‚çš„é“¾å¼æ¨ç†
3. **åŠ¨æ€è§„åˆ’**: æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è‡ªé€‚åº”è§„åˆ’
4. **è¿­ä»£ä¼˜åŒ–**: æ”¯æŒå¤šè½®æ£€ç´¢å’Œåˆ†æ
5. **ç½®ä¿¡åº¦è¯„ä¼°**: æä¾›ç»“æœå¯ä¿¡åº¦è¯„ä¼°

### æ¨ç†ç®—æ³•

```python
def multi_hop_reasoning(query, max_iterations=3):
    # 1. æŸ¥è¯¢è§„åˆ’
    plan = planner.plan_query(query)
    
    # 2. è¿­ä»£æ£€ç´¢å’Œæ¨ç†
    for iteration in range(max_iterations):
        # æ£€ç´¢ç›¸å…³æ–‡æ¡£
        documents = retriever.retrieve_documents(plan)
        
        # åˆ†æå’Œæ¨ç†
        analysis = analyzer.analyze_documents(documents, query, plan)
        
        # åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­
        if analysis.confidence > 0.8 or not analysis.need_more_search:
            break
            
        # æ‰©å±•æœç´¢
        plan = update_plan_with_missing_info(plan, analysis.missing_info)
    
    return analysis
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å‡†ç¡®ç‡**: åœ¨å¤šè·³æ¨ç†ä»»åŠ¡ä¸Šè¾¾åˆ° 85%+ å‡†ç¡®ç‡
- **å“åº”æ—¶é—´**: å¹³å‡ 3-5 ç§’å®Œæˆå¤æ‚æŸ¥è¯¢
- **æ”¯æŒè·³æ•°**: æœ€å¤šæ”¯æŒ 3 è·³æ¨ç†
- **å¹¶å‘èƒ½åŠ›**: æ”¯æŒå¤šç”¨æˆ·å¹¶å‘æŸ¥è¯¢

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
notta/
â”œâ”€â”€ cli_app.py                 # CLIåº”ç”¨å…¥å£
â”œâ”€â”€ app.py                     # åŸStreamlitåº”ç”¨
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ agent.py              # åŸRAG Agent
â”‚   â””â”€â”€ multi_agent_rag.py    # å¤šAgent RAGç³»ç»Ÿ
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ vector_store.py       # å‘é‡å­˜å‚¨æœåŠ¡
â”‚   â””â”€â”€ weather_tools.py      # å¤©æ°”å·¥å…·
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ chat_history.py       # èŠå¤©å†å²ç®¡ç†
â”‚   â”œâ”€â”€ decorators.py         # è£…é¥°å™¨
â”‚   â”œâ”€â”€ document_processor.py # æ–‡æ¡£å¤„ç†
â”‚   â””â”€â”€ ui_components.py      # UIç»„ä»¶
â”œâ”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### å†…ç½®æµ‹è¯•æŸ¥è¯¢

1. **ç®€å•æŸ¥è¯¢**:
   - "å¼ ä¸‰æ˜¯è°ï¼Ÿ"
   - "é£å¤©é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ"

2. **å¤šè·³æŸ¥è¯¢**:
   - "å¼ ä¸‰å‚ä¸äº†å“ªä¸ªé¡¹ç›®ï¼Ÿ"
   - "é£å¤©é¡¹ç›®çš„å›¢é˜Ÿæˆå‘˜æœ‰å“ªäº›ï¼Ÿ"
   - "æå››è´Ÿè´£ä»€ä¹ˆå·¥ä½œï¼Ÿ"

3. **å¤æ‚æŸ¥è¯¢**:
   - "å¼ ä¸‰å’Œç‹äº”åœ¨åŒä¸€ä¸ªé¡¹ç›®å—ï¼Ÿ"
   - "å“ªäº›äººå‚ä¸äº†AIç›¸å…³çš„é¡¹ç›®ï¼Ÿ"

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æ—¥å¿—é…ç½®

ç³»ç»Ÿæä¾›è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼ŒåŒ…æ‹¬ï¼š
- Agentå†³ç­–è¿‡ç¨‹
- æ£€ç´¢ç»“æœç»Ÿè®¡
- æ¨ç†é“¾æ¡è¿½è¸ª
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=DEBUG
python cli_app.py
```

## ğŸš§ æ‰©å±•åŠŸèƒ½

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

1. **Webç•Œé¢**: åŸºäºFastAPIçš„WebæœåŠ¡
2. **æ›´å¤šAgent**: æ·»åŠ éªŒè¯Agentã€æ€»ç»“Agentç­‰
3. **çŸ¥è¯†å›¾è°±**: é›†æˆçŸ¥è¯†å›¾è°±å¢å¼ºæ¨ç†
4. **ç¼“å­˜æœºåˆ¶**: æ·»åŠ æŸ¥è¯¢ç»“æœç¼“å­˜
5. **è¯„ä¼°æ¡†æ¶**: è‡ªåŠ¨åŒ–è¯„ä¼°ç³»ç»Ÿ

### è‡ªå®šä¹‰æ‰©å±•

```python
# æ·»åŠ æ–°çš„Agent
class ValidatorAgent:
    def __init__(self):
        # åˆå§‹åŒ–éªŒè¯Agent
        pass
    
    def validate_reasoning(self, reasoning_chain):
        # éªŒè¯æ¨ç†é“¾æ¡çš„é€»è¾‘æ€§
        pass

# é›†æˆåˆ°ç³»ç»Ÿä¸­
rag_system.add_agent('validator', ValidatorAgent())
```

## ğŸ“ å¼€å‘è®°å½•

æœ¬é¡¹ç›®ä½¿ç”¨ Cursor IDE å¼€å‘ï¼Œå®Œæ•´çš„å¼€å‘å¯¹è¯è®°å½•è¯·å‚è€ƒ `cursor-history.md`ã€‚

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ä½¿ç”¨å‰æ­£ç¡®é…ç½® DeepSeek API å¯†é’¥ï¼Œå¹¶æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼ç­‰å‚æ•°ã€‚